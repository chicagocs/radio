<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>SRG SSR Track Info</title>
<style>
  body { font-family: sans-serif; padding: 20px; }
  .track-info { margin-top: 20px; }
  .track-info img { max-width: 200px; display: block; margin-bottom: 10px; }
</style>
</head>
<body>

<h1>Información de la canción actual</h1>

<div class="track-info">
  <img id="album-cover" src="" alt="Portada del álbum">
  <p><strong>Título:</strong> <span id="track-title">Cargando...</span></p>
  <p><strong>Artista:</strong> <span id="track-artist">Cargando...</span></p>
  <p><strong>Álbum:</strong> <span id="track-album">Cargando...</span></p>
</div>

<script>
const workerUrl = 'https://weathered-mode-71a3.chcs.workers.dev/metadata';
const stream = 'https://livestreaming-node-4.srg-ssr.ch/srgssr/rsc_de/mp3/128'; // URL de tu stream

let currentTrack = { title: null, artist: null, album: null };

async function updateTrackInfo() {
  try {
    const response = await fetch(`${workerUrl}?stream=${encodeURIComponent(stream)}`);
    if (!response.ok) throw new Error(`HTTP error ${response.status}`);
    const data = await response.json();
    console.log('Metadata recibida:', data);

    // Solo actualizar si hay cambios
    if (data.title !== currentTrack.title || data.artist !== currentTrack.artist) {
      currentTrack = data;

      document.getElementById('track-title').textContent = data.title || 'Desconocido';
      document.getElementById('track-artist').textContent = data.artist || 'Desconocido';
      document.getElementById('track-album').textContent = data.album || '';

      // Si tu Worker o API de Spotify/otros devuelve imagen, actualízala aquí
      // document.getElementById('album-cover').src = data.imageUrl || '';
    }

  } catch (err) {
    console.error('Error al obtener metadata:', err);
  }
}

// Actualiza cada 10 segundos
updateTrackInfo();
setInterval(updateTrackInfo, 10000);
</script>

</body>
</html>
